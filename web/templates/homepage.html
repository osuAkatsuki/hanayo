{{ define "tpl" }}
  {{ $ := . }}

  <link rel="stylesheet" href="{{ asset "/static/css/pages/home.min.css" }}" />

  {{/* Hero Section */}}
  <div class="hero-section">
    <div class="hero-content">
      <img src="/static/images/logos/wordmark.svg" alt="Akatsuki" class="hero-wordmark">
      <div class="hero-online">
        {{ with bget "onlineUsers" }}
          {{ with .result }}
            <span class="pulse-dot"></span>
            <span class="online-count">{{ humanize . }} online</span>
          {{ end }}
        {{ end }}
      </div>
      <p class="hero-tagline">The home of relaxed osu! gameplay</p>
      <div class="hero-buttons">
        <a
          href="{{ if not .Context.User.ID }}/register{{ else }}/u/{{ .Context.User.ID }}{{ end }}"
          class="btn-primary"
        >
          {{ if not .Context.User.ID }}Get Started{{ else }}Profile{{ end }}
        </a>
        <a
          href="{{ if not .Context.User.ID }}/doc/connection_guide{{ else }}/leaderboard{{ end }}"
          class="btn-secondary"
        >
          {{ if not .Context.User.ID }}How to Connect{{ else }}Leaderboards{{ end }}
        </a>
      </div>
    </div>
  </div>

  {{/* Stats Strip */}}
  <div class="stats-strip">
    <div class="stat-item">
      {{ $users := rediget "akatsuki:registered_users" }}
      <span class="stat-value">{{ with atoi $users }}{{ humanize . }}{{ else }}100K+{{ end }}</span>
      <span class="stat-label">players</span>
    </div>
    <div class="stat-item">
      <span class="stat-value">78M+</span>
      <span class="stat-label">scores</span>
    </div>
    <div class="stat-item">
      {{ $maps := rediget "akatsuki:ranked_beatmaps" }}
      <span class="stat-value">{{ with atoi $maps }}{{ humanize . }}{{ else }}280K+{{ end }}</span>
      <span class="stat-label">beatmaps</span>
    </div>
    <div class="stat-item">
      {{ $years := rediget "akatsuki:total_playtime_years" }}
      <span class="stat-value">{{ with atoi $years }}{{ humanize . }}{{ else }}1,200+{{ end }}</span>
      <span class="stat-label">years played</span>
    </div>
  </div>

  {{/* Alert Banner */}}
  {{ $set := systemSettings "website_home_alert" }}
  {{ with $set.website_home_alert.String }}
    <div class="ui container">
      <div class="ui warning message" style="margin-top: 1rem;">
        {{ . | html }}
      </div>
    </div>
  {{ end }}

  {{/* Main Content: Two-Column Layout */}}
  <div class="homepage-main">
    {{/* Mode Selector */}}
    <div class="mode-selector-bar">
      <span class="mode-label">Mode:</span>
      <div class="mode-selector">
        <button class="mode-btn active" data-rx="1">Relax</button>
        <button class="mode-btn" data-rx="0">Vanilla</button>
        <button class="mode-btn" data-rx="2">Autopilot</button>
      </div>
    </div>

    <div class="content-grid">
      {{/* Left Column: Activity Feed */}}
      <div class="activity-column">
        <div class="activity-card">
          <div class="activity-tabs">
            <button class="activity-tab active" data-tab="first-places">First Places</button>
            <button class="activity-tab" data-tab="high-pp">High PP</button>
          </div>

          <div class="activity-content active" id="first-places">
            {{ range redigetJSON "akatsuki:recent_first_places" }}
              <div class="activity-item">
                <img src="https://a.akatsuki.gg/{{ ftoi .userid }}" class="activity-avatar" loading="lazy" alt="">
                <div class="activity-details">
                  <a href="/u/{{ ftoi .userid }}" class="activity-player">{{ .username }}</a>
                  <span class="activity-action">claimed #1 on</span>
                  <a href="/b/{{ ftoi .beatmap_id }}" class="activity-map">{{ .song_name }}</a>
                </div>
                <span class="activity-pp">{{ ftoi .pp }}pp</span>
              </div>
            {{ else }}
              <p class="no-activity">No recent first places</p>
            {{ end }}
          </div>

          <div class="activity-content" id="high-pp">
            {{ range redigetJSON "akatsuki:high_pp_plays_24h" }}
              <div class="activity-item">
                <img src="https://a.akatsuki.gg/{{ ftoi .userid }}" class="activity-avatar" loading="lazy" alt="">
                <div class="activity-details">
                  <a href="/u/{{ ftoi .userid }}" class="activity-player">{{ .username }}</a>
                  <span class="activity-action">set</span>
                  <a href="/b/{{ ftoi .beatmap_id }}" class="activity-map">{{ .song_name }}</a>
                </div>
                <span class="activity-pp">{{ ftoi .pp }}pp</span>
              </div>
            {{ else }}
              <p class="no-activity">No high PP plays in the last 24h</p>
            {{ end }}
          </div>
        </div>
      </div>

      {{/* Right Column: Trending Maps */}}
      <div class="trending-column">
        <div class="trending-card">
          <h3 class="trending-title">Trending This Week</h3>
          <div class="trending-grid">
            {{ range redigetJSON "akatsuki:trending_beatmaps" }}
              <a href="/b/{{ ftoi .beatmap_id }}" class="trending-map">
                <img
                  src="https://assets.ppy.sh/beatmaps/{{ ftoi .beatmapset_id }}/covers/card.jpg"
                  class="trending-bg"
                  loading="lazy"
                  alt=""
                >
                <div class="trending-overlay">
                  <span class="trending-name">{{ .song_name }}</span>
                  <span class="trending-plays">{{ ftoi .play_count }} plays</span>
                </div>
              </a>
            {{ else }}
              <p class="no-activity">No trending maps</p>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ asset "/static/js/pages/home.min.js" }}" defer></script>
{{ end }}
